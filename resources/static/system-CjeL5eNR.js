import{b9 as Ue,bt as ze,c as n,I as re,d as R,R as ie,a as x,b as s,aT as X,w as a,aS as Z,f as e,h as k,o as v,Y as Oe,r as A,u as N,m as ae,bc as E,e as z,aA as je,ak as L,bd as q,aU as P,bu as Ae,B as K,ax as Ie,bv as Pe,bw as G,g as y,bx as Q,M as W,p as le,by as Ve,k as Be,i as me,bz as He,bA as Me}from"./index-DR2sFYLK.js";import{S as ue,a as de,D as Fe}from"./index-DrqGB5BN.js";import{a as ve,_ as Le}from"./index-CYlS_cWu.js";import"./index-1FJT2FNA.js";import{T as qe,s as J}from"./utils-qokNeTiO.js";const De=Ue(ze);var Re={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};function ge(f){for(var i=1;i<arguments.length;i++){var u=arguments[i]!=null?Object(arguments[i]):{},_=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(u).filter(function(p){return Object.getOwnPropertyDescriptor(u,p).enumerable}))),_.forEach(function(p){Je(f,p,u[p])})}return f}function Je(f,i,u){return i in f?Object.defineProperty(f,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):f[i]=u,f}var ee=function(i,u){var _=ge({},i,u.attrs);return n(re,ge({},_,{icon:Re}),null)};ee.displayName="DeleteOutlined";ee.inheritAttrs=!1;var We={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};function be(f){for(var i=1;i<arguments.length;i++){var u=arguments[i]!=null?Object(arguments[i]):{},_=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(u).filter(function(p){return Object.getOwnPropertyDescriptor(u,p).enumerable}))),_.forEach(function(p){Ye(f,p,u[p])})}return f}function Ye(f,i,u){return i in f?Object.defineProperty(f,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):f[i]=u,f}var oe=function(i,u){var _=be({},i,u.attrs);return n(re,be({},_,{icon:We}),null)};oe.displayName="EditOutlined";oe.inheritAttrs=!1;var Ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};function xe(f){for(var i=1;i<arguments.length;i++){var u=arguments[i]!=null?Object(arguments[i]):{},_=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(u).filter(function(p){return Object.getOwnPropertyDescriptor(u,p).enumerable}))),_.forEach(function(p){Qe(f,p,u[p])})}return f}function Qe(f,i,u){return i in f?Object.defineProperty(f,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):f[i]=u,f}var _e=function(i,u){var _=xe({},i,u.attrs);return n(re,xe({},_,{icon:Ge}),null)};_e.displayName="MinusCircleOutlined";_e.inheritAttrs=!1;var Xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M848 359.3H627.7L825.8 109c4.1-5.3.4-13-6.3-13H436c-2.8 0-5.5 1.5-6.9 4L170 547.5c-3.1 5.3.7 12 6.9 12h174.4l-89.4 357.6c-1.9 7.8 7.5 13.3 13.3 7.7L853.5 373c5.2-4.9 1.7-13.7-5.5-13.7zM378.2 732.5l60.3-241H281.1l189.6-327.4h224.6L487 427.4h211L378.2 732.5z"}}]},name:"thunderbolt",theme:"outlined"};function he(f){for(var i=1;i<arguments.length;i++){var u=arguments[i]!=null?Object(arguments[i]):{},_=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(u).filter(function(p){return Object.getOwnPropertyDescriptor(u,p).enumerable}))),_.forEach(function(p){Ze(f,p,u[p])})}return f}function Ze(f,i,u){return i in f?Object.defineProperty(f,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):f[i]=u,f}var Y=function(i,u){var _=he({},i,u.attrs);return n(re,he({},_,{icon:Xe}),null)};Y.displayName="ThunderboltOutlined";Y.inheritAttrs=!1;const Ke={class:"space-y-4"},et=R({__name:"BrowserSettings",props:{config:{}},emits:["update:config"],setup(f,{emit:i}){const u=f,_=ie(()=>u.config);return(p,t)=>{const $=ve,d=Z,c=de,m=ue,o=X;return v(),x("div",Ke,[t[6]||(t[6]=s("h3",{class:"text-lg font-medium"},"浏览器配置",-1)),n(o,{layout:"vertical",class:"max-w-2xl"},{default:a(()=>[n(d,{label:"无头模式"},{default:a(()=>[n($,{checked:e(_).browser.headless,"onUpdate:checked":t[0]||(t[0]=b=>e(_).browser.headless=b)},null,8,["checked"]),t[2]||(t[2]=s("span",{class:"ml-2 text-gray-500"},"是否在后台运行浏览器",-1))]),_:1}),n(d,{label:"浏览器类型"},{default:a(()=>[n(m,{value:e(_).browser.channel,"onUpdate:value":t[1]||(t[1]=b=>e(_).browser.channel=b),class:"w-full"},{default:a(()=>[n(c,{value:"chrome"},{default:a(()=>[...t[3]||(t[3]=[k("Chrome",-1)])]),_:1}),n(c,{value:"firefox"},{default:a(()=>[...t[4]||(t[4]=[k("Firefox",-1)])]),_:1}),n(c,{value:"webkit"},{default:a(()=>[...t[5]||(t[5]=[k("WebKit",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})])}}}),tt={class:"space-y-4"},nt={class:"flex items-center pt-4 border-t border-gray-200"},st={class:"flex items-center gap-2"},at={class:"text-xs"},lt={key:0},ot={key:1},rt={class:"flex justify-between items-start mb-2"},it={class:"text-sm whitespace-pre-wrap font-mono bg-white/50 p-3 rounded"},ut={key:0,class:"space-y-2"},dt={class:"text-gray-700"},ct={key:1,class:"space-y-2"},pt={class:"text-gray-700"},we=R({__name:"NotifierForm",props:{modelValue:{}},emits:["update:modelValue"],setup(f,{expose:i,emit:u}){const _=f,p=u,t=Oe({..._.modelValue}),$=A(!1),d=A(null),c=A(!1),{data:m}=N("/api/notifier/templates").json();ae(t,()=>{p("update:modelValue",{...t})},{deep:!0});const o=w=>m.value?.find(l=>l.type===w),b=w=>{if(!w)return;const l=o(w);if(!l)return y.error("未找到该类型的模板");t.type=l.type,l.template&&Object.entries(l.template).forEach(([h,j])=>{j.default!==void 0&&(t[h]=j.default)})},C=ie(()=>t.type?o(t.type)?.template||{}:{}),B=async()=>{const w=[];t.name||w.push("通知名称"),t.type||w.push("通知类型");const l=o(t.type);if(l?.template&&Object.entries(l.template).forEach(([h,j])=>{j.required&&!t[h]&&w.push(j.name)}),w.length>0){y.error(`请填写以下必填字段：${w.join("、")}`);return}try{$.value=!0,d.value=null;const{error:h}=await N("/api/notifier/test").post(t).json();if(h.value)d.value=`❌ 通知连接测试失败

错误信息: ${h.value?.message||"未知错误"}
可能原因:
1. 配置信息错误
2. 通知服务无法访问
3. 网络连接问题`,y.error("通知连接测试失败");else{const j="测试成功",D=t.name;d.value=`✅ 通知连接测试成功！

通知名称: ${D}
通知类型: ${t.type}
测试响应: ${j.substring(0,200)}${j.length>200?"...":""}`,y.success("通知连接测试成功")}c.value=!0}catch(h){d.value=`❌ 测试过程中发生错误

错误信息: ${h.message||"未知错误"}
可能原因:
1. 网络连接中断
2. 服务器无响应
3. 请求超时`,y.error("测试过程中发生错误"),c.value=!0}finally{$.value=!1}},S=()=>{c.value=!1,d.value=null};return i({testNotifier:B,testing:$,testResult:d,testVisible:c}),(w,l)=>{const h=je,j=Z,D=de,M=ue,F=Ae,O=Le,U=K,te=Ie,ce=X;return v(),x("div",tt,[n(ce,{model:e(t),"label-col":{span:5},"wrapper-col":{span:18}},{default:a(()=>[n(j,{label:"通知名称",name:"name",required:""},{default:a(()=>[n(h,{value:e(t).name,"onUpdate:value":l[0]||(l[0]=g=>e(t).name=g),placeholder:"输入通知名称"},null,8,["value"])]),_:1}),n(j,{label:"通知类型",name:"type",required:""},{default:a(()=>[n(M,{placeholder:"选择通知类型",value:e(t).type,"onUpdate:value":l[1]||(l[1]=g=>e(t).type=g),onChange:b,"allow-clear":""},{default:a(()=>[(v(!0),x(L,null,q(e(m),g=>(v(),z(D,{key:g.type,value:g.type},{default:a(()=>[k(P(g.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e(t).type&&e(C)?(v(!0),x(L,{key:0},q(e(C),(g,r)=>(v(),z(j,{key:r,label:g.name,name:r,required:g.required},{default:a(()=>[g.type==="password"?(v(),z(F,{key:0,value:e(t)[r],"onUpdate:value":T=>e(t)[r]=T,placeholder:g.placeholder||`输入${g.name}`},null,8,["value","onUpdate:value","placeholder"])):g.type==="number"?(v(),z(O,{key:1,value:e(t)[r],"onUpdate:value":T=>e(t)[r]=T,placeholder:g.placeholder||`输入${g.name}`,style:{width:"100%"}},null,8,["value","onUpdate:value","placeholder"])):(v(),z(h,{key:2,value:e(t)[r],"onUpdate:value":T=>e(t)[r]=T,placeholder:g.placeholder||`输入${g.name}`},null,8,["value","onUpdate:value","placeholder"]))]),_:2},1032,["label","name","required"]))),128)):E("",!0),n(j,{"wrapper-col":{offset:5,span:18}},{default:a(()=>[s("div",nt,[s("div",st,[n(U,{type:"primary",onClick:B,loading:e($),disabled:!e(t).name||!e(t).type},{default:a(()=>[n(e(Y)),l[2]||(l[2]=k(" 测试连接 ",-1))]),_:1},8,["loading","disabled"]),!e(t).name||!e(t).type?(v(),z(te,{key:0},{title:a(()=>[s("div",at,[e(t).name?E("",!0):(v(),x("div",lt,"请填写通知名称")),e(t).type?E("",!0):(v(),x("div",ot,"请选择通知类型"))])]),default:a(()=>[n(e(Pe),{class:"text-gray-400"})]),_:1})):E("",!0)]),l[3]||(l[3]=s("span",{class:"text-gray-500 text-sm"}," 测试通过后再保存 ",-1))])]),_:1}),e(c)?(v(),z(j,{key:1,"wrapper-col":{offset:5,span:18}},{default:a(()=>[s("div",{class:G(["mt-2 p-4 border rounded",e(d)?.includes("✅")?"border-green-200 bg-green-50":"border-red-200 bg-red-50"])},[s("div",rt,[s("h4",{class:G(["font-medium",e(d)?.includes("✅")?"text-green-700":"text-red-700"])},P(e(d)?.includes("✅")?"✅ 测试成功":"❌ 测试失败"),3),n(U,{type:"text",size:"small",onClick:S},{default:a(()=>[...l[4]||(l[4]=[k(" 关闭 ",-1)])]),_:1})]),s("div",it,[e(d)?.includes("✅")?(v(),x("div",ut,[l[5]||(l[5]=s("div",{class:"text-green-700 font-medium"},"配置验证通过！",-1)),s("div",dt,P(e(d).replace(`✅ 通知连接测试成功！

`,"")),1)])):(v(),x("div",ct,[l[6]||(l[6]=s("div",{class:"text-red-700 font-medium"},"配置验证失败",-1)),s("div",pt,P(e(d)?.replace("❌ ","")),1),l[7]||(l[7]=s("div",{class:"text-gray-600 text-xs mt-2"},[k(" 请检查以下配置： "),s("ul",{class:"list-disc pl-4 mt-1"},[s("li",null,"通知类型是否正确"),s("li",null,"配置信息是否完整"),s("li",null,"网络连接是否正常")])],-1))]))])],2)]),_:1})):E("",!0)]),_:1},8,["model"])])}}}),ft={class:"flex-col h-full space-y-4"},mt={key:0,class:"flex-col flex-1"},vt={class:"flex justify-between items-center mb-4"},_t={key:0,class:"flex-1 h-0 space-y-3 overflow-auto"},yt={class:"flex justify-between items-start"},gt={class:"flex gap-2.5"},bt={class:"flex gap-2 ml-4"},xt={key:1,class:"text-center py-8 border border-dashed border-gray-300 rounded"},ht=R({__name:"NotificationSettings",props:{config:{}},emits:["update:config"],setup(f,{emit:i}){const u=f,_=i,{data:p,execute:t}=N("/api/notifier",{initialData:[]}).json(),$=A(!1),d=A(!1),c=ie(()=>u.config),m=w=>{const l={...c.value,...w};_("update:config",l)},o=()=>{const w=A({id:"",type:"ntfy",name:"通知1",enable:!0});W.confirm({title:"新建通知",width:600,content:le(we,{modelValue:w.value,"onUpdate:modelValue":l=>w.value=l}),async onOk(){try{$.value=!0;const l=w.value,{error:h}=await N("/api/notifier").post(l).json();h.value?y.error("添加失败"):(y.success("已添加"),await t())}catch{y.error("添加时发生错误")}finally{$.value=!1}}})},b=w=>{const l=p.value?.find(h=>h.id===w);l&&W.confirm({title:"确认删除",content:`确定要删除 "${l.name}" 吗？`,async onOk(){try{$.value=!0;const{error:h}=await N(`/api/notifier/${l.id}`).delete().json();h.value?y.error("删除失败"):(y.success("已删除"),await t())}catch{y.error("删除时发生错误")}finally{$.value=!1}}})},C=w=>{const l=p.value?.find(j=>j.id===w);if(!l)return;const h=A(l);W.confirm({title:"编辑通知配置",content:le(we,{modelValue:h.value,"onUpdate:modelValue":j=>h.value=j}),async onOk(){try{$.value=!0;const{error:j}=await N(`/api/notifier/${h.value.id}`).post(h.value).json();j.value?y.error("更新失败"):(y.success("已更新"),await t())}catch{y.error("更新时发生错误")}finally{$.value=!1}}})},B=async w=>{const l=p.value?.find(h=>h.id===w);if(l)try{$.value=!0;const{error:h}=await N(`/api/notifier/${w}`).post({...l,enable:!l.enable}).json();h.value?y.error("请求失败"):(y.success(l.enable?"已禁用":"已启用"),await t())}catch{y.error("请求时发生错误")}finally{$.value=!1}},S=async w=>{const l=p.value?.find(h=>h.id===w);if(l)try{d.value=!0;const{error:h}=await N(`/api/notifier/${l.id}/test`).post().json();h.value?y.error("Notifier连接测试失败"):y.success("Notifier连接测试成功")}catch{y.error("测试Notifier连接时发生错误")}finally{d.value=!1}};return(w,l)=>{const h=ve,j=Z,D=X,M=K,F=qe;return v(),x("div",ft,[l[10]||(l[10]=s("h3",{class:"text-lg font-medium"},"通知配置",-1)),n(D,{layout:"vertical",class:"max-w-2xl"},{default:a(()=>[n(j,{label:"启用通知"},{default:a(()=>[n(h,{checked:e(c).notifications.enabled,onChange:l[0]||(l[0]=O=>{const U={...e(c).notifications,enabled:!!O};m({notifications:U})})},null,8,["checked"]),l[1]||(l[1]=s("span",{class:"ml-2 text-gray-500"},"是否启用消息通知功能",-1))]),_:1})]),_:1}),e(c).notifications.enabled?(v(),x("div",mt,[s("div",vt,[l[3]||(l[3]=s("h4",{class:"text-md font-medium"},"已配置的通知",-1)),n(M,{type:"primary",onClick:o},{default:a(()=>[n(e(Q)),l[2]||(l[2]=k(" 添加通知 ",-1))]),_:1})]),e(p)&&e(p).length>0?(v(),x("div",_t,[(v(!0),x(L,null,q(e(p),O=>(v(),x("div",{key:O.id,class:"border border-gray-200 rounded p-4 bg-white hover:border-blue-300 transition-colors"},[s("div",yt,[s("div",gt,[O.enable?(v(),z(F,{key:0,color:"success"},{default:a(()=>[...l[4]||(l[4]=[k(" 已启用 ",-1)])]),_:1})):(v(),z(F,{key:1,color:"default"},{icon:a(()=>[n(e(_e))]),default:a(()=>[l[5]||(l[5]=k(" 未启用 ",-1))]),_:1})),n(h,{checked:O.enable,onChange:U=>B(O.id)},null,8,["checked","onChange"]),s("div",null,P(O.name),1),s("div",null,"提供商: "+P(O.type),1)]),s("div",bt,[n(M,{type:"primary",size:"small",onClick:U=>C(O.id),disabled:e(d)},{default:a(()=>[...l[6]||(l[6]=[k(" 编辑 ",-1)])]),_:1},8,["onClick","disabled"]),n(M,{type:"default",size:"small",onClick:U=>S(O.id),loading:e(d)},{default:a(()=>[n(e(Y)),l[7]||(l[7]=k(" 测试 ",-1))]),_:1},8,["onClick","loading"]),n(M,{type:"text",danger:"",size:"small",onClick:U=>b(O.id),disabled:e(d)},{default:a(()=>[n(e(ee))]),_:1},8,["onClick","disabled"])])])]))),128))])):(v(),x("div",xt,[l[9]||(l[9]=s("p",{class:"text-gray-500 mb-4"},"尚未配置任何通知",-1)),n(M,{type:"primary",onClick:o},{default:a(()=>[n(e(Q)),l[8]||(l[8]=k(" 添加第一个通知 ",-1))]),_:1})]))])):E("",!0)])}}}),wt={class:"space-y-4"},kt={key:0},$t=R({__name:"EvaluatorSettings",props:{config:{}},emits:["update:config"],setup(f,{emit:i}){const u=f,_=i,p=ie(()=>u.config),{data:t}=N("/api/ai",{initialData:[]}).json(),$=d=>{const c={...p.value,...d};_("update:config",c)};return(d,c)=>{const m=ve,o=Z,b=de,C=ue,B=X;return v(),x("div",wt,[c[4]||(c[4]=s("h3",{class:"text-lg font-medium"},"商品评估器配置",-1)),n(B,{layout:"vertical",class:"max-w-2xl"},{default:a(()=>[n(o,{label:"启用评估器"},{default:a(()=>[n(m,{checked:e(p).evaluator.enabled,onChange:c[0]||(c[0]=S=>{const w={...e(p).evaluator,enabled:!!S};$({evaluator:w})})},null,8,["checked"]),c[3]||(c[3]=s("span",{class:"ml-2 text-gray-500"},"是否启用AI商品分析评估",-1))]),_:1}),e(p).evaluator.enabled?(v(),x("div",kt,[n(o,{label:"文本分析 AI"},{default:a(()=>[n(C,{value:e(p).evaluator.textAI||void 0,onChange:c[1]||(c[1]=S=>{const w={...e(p).evaluator,textAI:S||null};$({evaluator:w})}),class:"w-full",placeholder:"选择用于文本分析的 AI","allow-clear":""},{default:a(()=>[(v(!0),x(L,null,q(e(t),S=>(v(),z(b,{key:S.id,value:S.id},{default:a(()=>[k(P(S.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(o,{label:"图像分析 AI"},{default:a(()=>[n(C,{value:e(p).evaluator.imageAI||void 0,onChange:c[2]||(c[2]=S=>{const w={...e(p).evaluator,imageAI:S||null};$({evaluator:w})}),class:"w-full",placeholder:"选择用于图像分析的 AI","allow-clear":""},{default:a(()=>[(v(!0),x(L,null,q(e(t),S=>(v(),z(b,{key:S.id,value:S.id},{default:a(()=>[k(P(S.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})])):E("",!0)]),_:1})])}}});var se={exports:{}},ke;function Ct(){return ke||(ke=1,(function(f,i){Function("return this")(),(function(u){f&&f.exports&&(i=f.exports=_),i.clone=_;function _(d){var c=typeof d;switch(c){case"object":if(d==null)return d;var m=void 0;return d instanceof Date?(m=new Date,m.setTime(d.getTime()),m):d instanceof RegExp?(m=$(d),m):(m=JSON.parse(JSON.stringify(d)),t(d,m),m);default:return d}}function p(d,c,m){var o=d[m],b=typeof o;switch(b){case"object":if(o instanceof Date){var C=new Date;C.setTime(o.getTime()),c[m]=C}else o instanceof RegExp?c[m]=$(o):o==null?c[m]=o:t(o,c[m]);break;case"number":isNaN(o)?c[m]=NaN:o==1/0&&(c[m]=1/0);break}}function t(d,c){if(d instanceof Array)for(var m=0;m<d.length;m++)p(d,c,m);else{var o=Object.getOwnPropertyNames(d);o.forEach(function(b){p(d,c,b)})}}function $(d){var c=String(d),m=c.lastIndexOf("/");return new RegExp(c.slice(1,m),c.slice(m+1))}})()})(se,se.exports)),se.exports}var Ot=Ct();const $e=Ve(Ot),jt={class:"space-y-4"},At={class:"flex flex-col gap-2"},It={key:0,class:"mb-2"},Pt={class:"font-mono text-sm"},St={class:"text-blue-600"},Nt={class:"text-green-600"},Tt={key:1,class:"flex flex-col gap-2"},Et={class:"flex gap-2"},Ut={key:2,class:"flex gap-2"},zt={class:"flex flex-col gap-2"},Vt={key:0,class:"flex flex-col gap-2"},Bt={class:"flex gap-2"},Ht={key:1},Mt={class:"mb-2"},Ft={class:"bg-gray-50 p-3 rounded text-sm overflow-auto max-h-40"},Lt={class:"flex gap-2"},qt={class:"flex items-center pt-4 border-t border-gray-200"},Dt={class:"flex items-center gap-2"},Rt={class:"text-xs"},Jt={key:0},Wt={key:1},Yt={key:2},Gt={key:3},Qt={class:"flex justify-between items-start mb-2"},Xt={class:"text-sm whitespace-pre-wrap font-mono bg-white/50 p-3 rounded"},Zt={key:0,class:"space-y-2"},Kt={class:"text-gray-700"},en={key:1,class:"space-y-2"},tn={class:"text-gray-700"},nn=R({__name:"AIForm",props:{modelValue:{}},emits:["update:modelValue"],setup(f,{expose:i,emit:u}){const _=f,p=u,t=Oe({..._.modelValue}),$=A(!1),d=A(!1),c=A(!1),m=A(""),o=A(""),{data:b}=N("/api/ai/templates").json();ae(t,()=>{p("update:modelValue",{...t})},{deep:!0}),ae(()=>t.headers,g=>{m.value=J(g||{})},{immediate:!0}),ae(()=>t.body,g=>{o.value=J(g||{})},{immediate:!0});const C=g=>{if(!g)return;const r=b.value?.find(T=>T.id===g);if(!r)return y.error("未找到模板");t.endpoint=r.endpoint,t.model=r.model,t.headers=$e(r.headers),t.body=$e(r.body)},B=()=>{t.headers||(t.headers={});const g=prompt("请输入请求头的键名：");if(!g)return;const r=prompt("请输入请求头的值：");r!==null&&(t.headers[g]=r,m.value=J(t.headers))},S=g=>{t.headers&&t.headers[g]&&(delete t.headers[g],m.value=J(t.headers))},w=()=>{d.value=!0},l=()=>{try{t.headers=JSON.parse(m.value),d.value=!1,y.success("请求头保存成功")}catch{y.error("JSON格式错误，请检查输入")}},h=()=>{m.value=J(t.headers||{}),d.value=!1},j=()=>{c.value=!0},D=()=>{try{t.body=JSON.parse(o.value),c.value=!1,y.success("请求体保存成功")}catch{y.error("JSON格式错误，请检查输入")}},M=()=>{o.value=J(t.body||{}),c.value=!1},F=A(!1),O=A(null),U=A(!1),te=async()=>{const g=[];if(t.name||g.push("Agent名称"),t.endpoint||g.push("API端点"),t.model||g.push("模型名称"),t.api_key||g.push("API密钥"),g.length>0){y.error(`请填写以下必填字段：${g.join("、")}`);return}try{F.value=!0,O.value=null;const r={id:"test-"+Date.now(),name:t.name,endpoint:t.endpoint,api_key:t.api_key,model:t.model,proxy:t.proxy||"",headers:t.headers,body:t.body},{error:T,data:V}=await N("/api/ai/test").post(r).json();if(!T.value&&V.value){const ne=V.value.response||"测试成功",pe=r.name;O.value=`✅ 连接测试成功！

名称: ${pe}
模型: ${r.model}
API端点: ${r.endpoint}
测试响应: ${ne.substring(0,200)}${ne.length>200?"...":""}`,y.success("连接测试成功")}else O.value=`❌ 连接测试失败

错误信息: ${T.value?.message||"未知错误"}
可能原因:
1. API密钥无效
2. 模型名称错误
3. API端点无法访问
4. 网络连接问题
5. 请求头/请求体配置错误`,y.error("连接测试失败");U.value=!0}catch(r){O.value=`❌ 测试过程中发生错误

错误信息: ${r.message||"未知错误"}
可能原因:
1. 网络连接中断
2. 服务器无响应
3. 请求超时`,y.error("测试过程中发生错误"),U.value=!0}finally{F.value=!1}},ce=()=>{U.value=!1,O.value=null};return i({testConfig:te,testing:F,testResult:O,testVisible:U}),(g,r)=>{const T=je,V=Z,ne=de,pe=ue,Se=Ae,H=K,Ne=De,ye=Be,Te=Ie,Ee=X;return v(),x("div",jt,[n(Ee,{model:e(t),"label-col":{span:5},"wrapper-col":{span:18}},{default:a(()=>[n(V,{label:"名称",name:"name",required:""},{default:a(()=>[n(T,{value:e(t).name,"onUpdate:value":r[0]||(r[0]=I=>e(t).name=I),placeholder:"输入名称"},null,8,["value"])]),_:1}),n(V,{label:"模板选择"},{default:a(()=>[n(pe,{placeholder:"选择预设模板",onChange:C,"allow-clear":""},{default:a(()=>[(v(!0),x(L,null,q(e(b),I=>(v(),z(ne,{key:I.id,value:I.id},{default:a(()=>[k(P(I.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1}),n(V,{label:"API端点",name:"endpoint",required:""},{default:a(()=>[n(T,{value:e(t).endpoint,"onUpdate:value":r[1]||(r[1]=I=>e(t).endpoint=I),placeholder:"https://api.openai.com/v1/chat/completions"},null,8,["value"])]),_:1}),n(V,{label:"API密钥"},{default:a(()=>[n(Se,{value:e(t).api_key,"onUpdate:value":r[2]||(r[2]=I=>e(t).api_key=I),placeholder:"输入API密钥"},null,8,["value"])]),_:1}),n(V,{label:"模型名称",name:"model",required:""},{default:a(()=>[n(T,{value:e(t).model,"onUpdate:value":r[3]||(r[3]=I=>e(t).model=I),placeholder:"gpt-3.5-turbo"},null,8,["value"])]),_:1}),n(Ne,{align:"right"},{default:a(()=>[n(H,{type:"link",onClick:r[4]||(r[4]=I=>$.value=!e($)),class:"p-0 h-auto"},{default:a(()=>[k(P(e($)?"收起":"展开")+"高级配置 ",1),n(e(Fe),{class:G({"rotate-180":e($)})},null,8,["class"])]),_:1})]),_:1}),e($)?(v(),x(L,{key:0},[n(V,{label:"代理地址"},{default:a(()=>[n(T,{value:e(t).proxy,"onUpdate:value":r[5]||(r[5]=I=>e(t).proxy=I),placeholder:"代理地址 http://proxy:port"},null,8,["value"])]),_:1}),n(V,{label:"请求头配置"},{default:a(()=>[s("div",At,[e(t).headers&&Object.keys(e(t).headers).length>0?(v(),x("div",It,[(v(!0),x(L,null,q(e(t).headers,(I,fe)=>(v(),x("div",{key:fe,class:"flex items-center justify-between py-1 px-2 bg-gray-50 rounded mb-1"},[s("span",Pt,[s("span",St,P(fe),1),r[8]||(r[8]=k(": ",-1)),s("span",Nt,P(I),1)]),n(H,{type:"text",danger:"",size:"small",onClick:$n=>S(fe)},{default:a(()=>[n(e(ee))]),_:1},8,["onClick"])]))),128))])):E("",!0),e(d)?(v(),x("div",Tt,[n(ye,{value:e(m),"onUpdate:value":r[6]||(r[6]=I=>me(m)?m.value=I:null),rows:6,placeholder:'输入JSON格式的请求头，例如：{"Authorization": "Bearer {key}", "Content-Type": "application/json"}'},null,8,["value"]),s("div",Et,[n(H,{type:"primary",onClick:l},{default:a(()=>[...r[9]||(r[9]=[k("保存",-1)])]),_:1}),n(H,{onClick:h},{default:a(()=>[...r[10]||(r[10]=[k("取消",-1)])]),_:1})])])):(v(),x("div",Ut,[n(H,{onClick:B,type:"dashed"},{default:a(()=>[n(e(Q)),r[11]||(r[11]=k(" 添加请求头 ",-1))]),_:1}),n(H,{onClick:w},{default:a(()=>[n(e(oe)),r[12]||(r[12]=k(" 编辑JSON ",-1))]),_:1})]))])]),_:1}),n(V,{label:"请求体配置"},{default:a(()=>[s("div",zt,[e(c)?(v(),x("div",Vt,[n(ye,{value:e(o),"onUpdate:value":r[7]||(r[7]=I=>me(o)?o.value=I:null),rows:8,placeholder:'输入JSON格式的请求体模板，例如：{"model": "{model}", "messages": {messages}, "temperature": 0.2}',有好感:""},null,8,["value"]),s("div",Bt,[n(H,{type:"primary",onClick:D},{default:a(()=>[...r[13]||(r[13]=[k("保存",-1)])]),_:1}),n(H,{onClick:M},{default:a(()=>[...r[14]||(r[14]=[k("取消",-1)])]),_:1})])])):(v(),x("div",Ht,[s("div",Mt,[s("pre",Ft,P(e(o)),1)]),s("div",Lt,[n(H,{onClick:j},{default:a(()=>[n(e(oe)),r[15]||(r[15]=k(" 编辑请求体 ",-1))]),_:1})])]))])]),_:1})],64)):E("",!0),n(V,{"wrapper-col":{offset:5,span:18}},{default:a(()=>[s("div",qt,[s("div",Dt,[n(H,{type:"primary",onClick:te,loading:e(F),disabled:!e(t).name||!e(t).endpoint||!e(t).model||!e(t).api_key},{default:a(()=>[n(e(Y)),r[16]||(r[16]=k(" 测试连接 ",-1))]),_:1},8,["loading","disabled"]),!e(t).name||!e(t).endpoint||!e(t).model||!e(t).api_key?(v(),z(Te,{key:0},{title:a(()=>[s("div",Rt,[e(t).name?E("",!0):(v(),x("div",Jt,"请填写Agent名称")),e(t).endpoint?E("",!0):(v(),x("div",Wt,"请填写API端点")),e(t).model?E("",!0):(v(),x("div",Yt,"请填写模型名称")),e(t).api_key?E("",!0):(v(),x("div",Gt,"请填写API密钥"))])]),default:a(()=>[n(e(Pe),{class:"text-gray-400"})]),_:1})):E("",!0)]),r[17]||(r[17]=s("span",{class:"text-gray-500 text-sm"}," 测试通过后再保存 ",-1))])]),_:1}),e(U)?(v(),z(V,{key:1,"wrapper-col":{offset:5,span:18}},{default:a(()=>[s("div",{class:G(["mt-2 p-4 border rounded",e(O)?.includes("✅")?"border-green-200 bg-green-50":"border-red-200 bg-red-50"])},[s("div",Qt,[s("h4",{class:G(["font-medium",e(O)?.includes("✅")?"text-green-700":"text-red-700"])},P(e(O)?.includes("✅")?"✅ 测试成功":"❌ 测试失败"),3),n(H,{type:"text",size:"small",onClick:ce},{default:a(()=>[...r[18]||(r[18]=[k(" 关闭 ",-1)])]),_:1})]),s("div",Xt,[e(O)?.includes("✅")?(v(),x("div",Zt,[r[19]||(r[19]=s("div",{class:"text-green-700 font-medium"},"配置验证通过！",-1)),s("div",Kt,P(e(O).replace(`✅ Agent连接测试成功！

`,"")),1)])):(v(),x("div",en,[r[20]||(r[20]=s("div",{class:"text-red-700 font-medium"},"配置验证失败",-1)),s("div",tn,P(e(O)?.replace("❌ ","")),1),r[21]||(r[21]=s("div",{class:"text-gray-600 text-xs mt-2"},[k(" 请检查以下配置： "),s("ul",{class:"list-disc pl-4 mt-1"},[s("li",null,"API端点是否正确"),s("li",null,"API密钥是否有效"),s("li",null,"模型名称是否正确"),s("li",null,"网络连接是否正常")])],-1))]))])],2)]),_:1})):E("",!0)]),_:1},8,["model"])])}}}),sn=(f,i)=>{const u=f.__vccOpts||f;for(const[_,p]of i)u[_]=p;return u},Ce=sn(nn,[["__scopeId","data-v-bd73a66c"]]),an={class:"flex-col h-full space-y-4"},ln={class:"flex-col flex-1"},on={class:"flex justify-between items-center mb-4"},rn={key:0,class:"space-y-3 h-0 flex-1 overflow-auto"},un={class:"flex justify-between items-start"},dn={class:"flex-1"},cn={class:"flex items-center gap-2 mb-2"},pn={class:"font-medium text-gray-800"},fn={class:"text-xs px-2 py-1 bg-gray-100 rounded text-gray-600"},mn={class:"text-sm text-gray-600 space-y-1"},vn={class:"flex items-center gap-2"},_n={class:"text-xs bg-gray-50 px-2 py-1 rounded truncate max-w-xs"},yn={class:"flex items-center gap-2"},gn={class:"text-xs"},bn={class:"flex gap-2 ml-4"},xn={key:1,class:"text-center py-8 border border-dashed border-gray-300 rounded"},hn=R({__name:"AISettings",setup(f){const{data:i,execute:u}=N("/api/ai",{initialData:[]}).json(),_=A(!1),p=A(!1),t=()=>{const m=A({id:"",name:"AI",endpoint:"",api_key:"",model:"",headers:{Authorization:"Bearer {key}","Content-Type":"application/json"},body:{model:"{model}",messages:"{messages}"}});W.confirm({title:"创建 AI 配置",width:600,content:le(Ce,{modelValue:m.value,"onUpdate:modelValue":o=>m.value=o}),async onOk(){try{_.value=!0;const{error:o}=await N("/api/ai").post(m.value).json();o.value?y.error("添加失败"):(y.success("已添加"),await u())}catch{y.error("添加时发生错误")}finally{_.value=!1}}})},$=m=>{const o=i.value?.find(b=>b.id===m);o&&W.confirm({title:"确认删除",content:`确定要删除 "${o.name}" 吗？`,async onOk(){try{_.value=!0;const{error:b}=await N(`/api/ai/${o.id}`).delete().json();b.value?y.error("删除失败"):(y.success("已删除"),await u())}catch{y.error("删除时发生错误")}finally{_.value=!1}}})},d=m=>{const o=i.value?.find(C=>C.id===m);if(!o)return;const b=A(o);W.confirm({title:"编辑 AI 配置",width:600,content:le(Ce,{modelValue:b.value,"onUpdate:modelValue":C=>b.value=C}),async onOk(){try{_.value=!0;const{error:C}=await N(`/api/ai/${b.value.id}`).post(b.value).json();C.value?y.error("更新失败"):(y.success("已更新"),await u())}catch{y.error("更新时发生错误")}finally{_.value=!1}}})},c=async m=>{const o=i.value?.find(b=>b.id===m);if(o)try{p.value=!0;const{error:b}=await N(`/api/ai/${o.id}/test`).post().json();b.value?y.error("连接测试失败"):y.success("连接测试成功")}catch{y.error("测试连接时发生错误")}finally{p.value=!1}};return(m,o)=>{const b=K;return v(),x("div",an,[o[8]||(o[8]=s("h3",{class:"text-lg font-medium"},"AI 配置",-1)),s("div",ln,[s("div",on,[o[1]||(o[1]=s("h4",{class:"text-md font-medium"},"已配置的 AI",-1)),n(b,{type:"primary",onClick:t,loading:e(_)},{default:a(()=>[n(e(Q)),o[0]||(o[0]=k(" 添加AI ",-1))]),_:1},8,["loading"])]),e(i)&&e(i).length>0?(v(),x("div",rn,[(v(!0),x(L,null,q(e(i),C=>(v(),x("div",{key:C.id,class:"border border-gray-200 rounded p-4 bg-white hover:border-blue-300 transition-colors"},[s("div",un,[s("div",dn,[s("div",cn,[s("h5",pn,P(C.name),1),s("span",fn,P(C.model),1)]),s("div",mn,[s("div",vn,[o[2]||(o[2]=s("span",{class:"font-medium"},"端点:",-1)),s("code",_n,P(C.endpoint),1)]),s("div",yn,[o[3]||(o[3]=s("span",{class:"font-medium"},"API密钥:",-1)),s("span",gn,P(C.api_key?"••••••••":"未设置"),1)])])]),s("div",bn,[n(b,{type:"primary",size:"small",onClick:B=>d(C.id),disabled:e(p)},{default:a(()=>[...o[4]||(o[4]=[k(" 编辑 ",-1)])]),_:1},8,["onClick","disabled"]),n(b,{type:"default",size:"small",onClick:B=>c(C.id),loading:e(p)},{default:a(()=>[n(e(Y)),o[5]||(o[5]=k(" 测试 ",-1))]),_:1},8,["onClick","loading"]),n(b,{type:"text",danger:"",size:"small",onClick:B=>$(C.id),disabled:e(p)},{default:a(()=>[n(e(ee))]),_:1},8,["onClick","disabled"])])])]))),128))])):(v(),x("div",xn,[o[7]||(o[7]=s("p",{class:"text-gray-500 mb-4"},"尚未配置任何 AI",-1)),n(b,{type:"primary",onClick:t},{default:a(()=>[n(e(Q)),o[6]||(o[6]=k(" 添加第一个 AI ",-1))]),_:1})]))])])}}}),wn={class:"flex-col p-4 h-full"},kn={class:"flex justify-between mb-6 items-center"},Pn=R({__name:"system",setup(f){const i=A("browser"),{data:u,execute:_}=N("api/system",{initialData:{browser:{headless:!0,channel:"chrome"},notifications:{enabled:!1,providers:[]},evaluator:{enabled:!0,textAI:null,imageAI:null}}}).json(),p=A(!1),t=d=>{u.value=d},$=async()=>{p.value=!0;const{error:d}=await N("api/system").post(u.value).json();p.value=!1,d.value?y.error("保存失败"):(y.success("保存成功"),await _())};return(d,c)=>{const m=K,o=Me,b=He;return v(),x("div",wn,[s("div",kn,[c[2]||(c[2]=s("h2",{class:"text-xl font-semibold"},"系统设置",-1)),n(m,{type:"primary",onClick:$,loading:e(p)},{default:a(()=>[...c[1]||(c[1]=[k(" 保存配置 ",-1)])]),_:1},8,["loading"])]),n(b,{activeKey:e(i),"onUpdate:activeKey":c[0]||(c[0]=C=>me(i)?i.value=C:null),class:"h-0 flex-1 [&>.ant-tabs-content]:h-full"},{default:a(()=>[n(o,{key:"browser",tab:"浏览器设置"},{default:a(()=>[n(et,{config:e(u),"onUpdate:config":t},null,8,["config"])]),_:1}),n(o,{key:"notifications",tab:"通知设置"},{default:a(()=>[n(ht,{config:e(u),"onUpdate:config":t},null,8,["config"])]),_:1}),n(o,{key:"evaluator",tab:"商品评估器设置"},{default:a(()=>[n($t,{config:e(u),"onUpdate:config":t},null,8,["config"])]),_:1}),n(o,{key:"ai",tab:"AI设置"},{default:a(()=>[n(hn)]),_:1})]),_:1},8,["activeKey"])])}}});export{Pn as default};
