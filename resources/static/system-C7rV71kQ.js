import{b9 as Ue,bG as Be,c as n,I as X,d as R,R as ie,a as x,b as a,f as e,aT as Z,w as o,aS as K,h as k,o as m,Y as Ae,r as I,u as N,m as oe,bc as z,e as U,aA as Ie,ak as F,be as D,aU as S,bH as Pe,B as ee,ax as Se,bI as Ne,bB as Y,g,bJ as Q,M as W,p as le,bK as He,k as Me,i as ve,bL as Le,bM as Fe}from"./index-sEUou1Ah.js";import{S as ue,a as de,D as De}from"./index-D7cOJZhE.js";import{_ as _e}from"./index-DkQ45nH5.js";import{_ as qe}from"./index-CZG-lxm7.js";import"./index-iJOMcIax.js";import{T as Re,s as J}from"./utils-BsNiUfvF.js";import{_ as Je}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./move-DUAnFZwj.js";const We=Ue(Be);var Ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};function be(f){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?Object(arguments[s]):{},v=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(d).filter(function(c){return Object.getOwnPropertyDescriptor(d,c).enumerable}))),v.forEach(function(c){Ye(f,c,d[c])})}return f}function Ye(f,s,d){return s in f?Object.defineProperty(f,s,{value:d,enumerable:!0,configurable:!0,writable:!0}):f[s]=d,f}var te=function(s,d){var v=be({},s,d.attrs);return n(X,be({},v,{icon:Ge}),null)};te.displayName="DeleteOutlined";te.inheritAttrs=!1;var Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};function xe(f){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?Object(arguments[s]):{},v=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(d).filter(function(c){return Object.getOwnPropertyDescriptor(d,c).enumerable}))),v.forEach(function(c){Xe(f,c,d[c])})}return f}function Xe(f,s,d){return s in f?Object.defineProperty(f,s,{value:d,enumerable:!0,configurable:!0,writable:!0}):f[s]=d,f}var re=function(s,d){var v=xe({},s,d.attrs);return n(X,xe({},v,{icon:Qe}),null)};re.displayName="EditOutlined";re.inheritAttrs=!1;var Ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};function he(f){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?Object(arguments[s]):{},v=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(d).filter(function(c){return Object.getOwnPropertyDescriptor(d,c).enumerable}))),v.forEach(function(c){Ke(f,c,d[c])})}return f}function Ke(f,s,d){return s in f?Object.defineProperty(f,s,{value:d,enumerable:!0,configurable:!0,writable:!0}):f[s]=d,f}var ge=function(s,d){var v=he({},s,d.attrs);return n(X,he({},v,{icon:Ze}),null)};ge.displayName="MinusCircleOutlined";ge.inheritAttrs=!1;var et={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M848 359.3H627.7L825.8 109c4.1-5.3.4-13-6.3-13H436c-2.8 0-5.5 1.5-6.9 4L170 547.5c-3.1 5.3.7 12 6.9 12h174.4l-89.4 357.6c-1.9 7.8 7.5 13.3 13.3 7.7L853.5 373c5.2-4.9 1.7-13.7-5.5-13.7zM378.2 732.5l60.3-241H281.1l189.6-327.4h224.6L487 427.4h211L378.2 732.5z"}}]},name:"thunderbolt",theme:"outlined"};function we(f){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?Object(arguments[s]):{},v=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(d).filter(function(c){return Object.getOwnPropertyDescriptor(d,c).enumerable}))),v.forEach(function(c){tt(f,c,d[c])})}return f}function tt(f,s,d){return s in f?Object.defineProperty(f,s,{value:d,enumerable:!0,configurable:!0,writable:!0}):f[s]=d,f}var G=function(s,d){var v=we({},s,d.attrs);return n(X,we({},v,{icon:et}),null)};G.displayName="ThunderboltOutlined";G.inheritAttrs=!1;var nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"};function $e(f){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?Object(arguments[s]):{},v=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(d).filter(function(c){return Object.getOwnPropertyDescriptor(d,c).enumerable}))),v.forEach(function(c){at(f,c,d[c])})}return f}function at(f,s,d){return s in f?Object.defineProperty(f,s,{value:d,enumerable:!0,configurable:!0,writable:!0}):f[s]=d,f}var ce=function(s,d){var v=$e({},s,d.attrs);return n(X,$e({},v,{icon:nt}),null)};ce.displayName="WarningOutlined";ce.inheritAttrs=!1;const st={class:"space-y-4"},ot={class:"space-x-2 text-orange"},lt=R({__name:"BrowserSettings",props:{config:{}},emits:["update:config"],setup(f,{emit:s}){const d=f,v=s,c=ie(()=>d.config),t=$=>{const i={...c.value,...$};v("update:config",i)};return($,i)=>{const _=_e,p=K,r=de,y=ue,O=Z;return m(),x("div",st,[i[7]||(i[7]=a("h3",{class:"text-lg font-medium"},"浏览器配置",-1)),a("div",ot,[n(e(ce)),i[2]||(i[2]=a("span",null,"docker 环境下将忽略以下设置",-1))]),n(O,{layout:"vertical",class:"max-w-2xl"},{default:o(()=>[n(p,{label:"无头模式"},{default:o(()=>[n(_,{checked:e(c).browser.headless,onChange:i[0]||(i[0]=T=>{const A={...e(c).browser,headless:!!T};t({browser:A})})},null,8,["checked"]),i[3]||(i[3]=a("span",{class:"ml-2 text-gray-500"},"是否在后台运行浏览器",-1))]),_:1}),n(p,{label:"浏览器类型"},{default:o(()=>[n(y,{value:e(c).browser.channel,class:"w-full",onChange:i[1]||(i[1]=T=>{const A={...e(c).browser,channel:T};t({browser:A})})},{default:o(()=>[n(r,{value:"chrome"},{default:o(()=>[...i[4]||(i[4]=[k("Chrome",-1)])]),_:1}),n(r,{value:"firefox"},{default:o(()=>[...i[5]||(i[5]=[k("Firefox",-1)])]),_:1}),n(r,{value:"webkit"},{default:o(()=>[...i[6]||(i[6]=[k("WebKit",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})])}}}),rt={class:"space-y-4"},it={class:"flex items-center pt-4 border-t border-gray-200"},ut={class:"flex items-center gap-2"},dt={class:"text-xs"},ct={key:0},pt={key:1},ft={class:"flex justify-between items-start mb-2"},mt={class:"text-sm whitespace-pre-wrap font-mono bg-white/50 p-3 rounded"},vt={key:0,class:"space-y-2"},_t={class:"text-gray-700"},gt={key:1,class:"space-y-2"},yt={class:"text-gray-700"},ke=R({__name:"NotifierForm",props:{modelValue:{}},emits:["update:modelValue"],setup(f,{expose:s,emit:d}){const v=f,c=d,t=Ae({...v.modelValue}),$=I(!1),i=I(null),_=I(!1),{data:p}=N("/api/notifier/templates").json();oe(t,()=>{c("update:modelValue",{...t})},{deep:!0});const r=w=>p.value?.find(l=>l.type===w),y=w=>{if(!w)return;const l=r(w);if(!l)return g.error("未找到该类型的模板");t.type=l.type,l.template&&Object.entries(l.template).forEach(([h,j])=>{j.default!==void 0&&(t[h]=j.default)})},O=ie(()=>t.type?r(t.type)?.template||{}:{}),T=async()=>{const w=[];t.name||w.push("通知名称"),t.type||w.push("通知类型");const l=r(t.type);if(l?.template&&Object.entries(l.template).forEach(([h,j])=>{j.required&&!t[h]&&w.push(j.name)}),w.length>0){g.error(`请填写以下必填字段：${w.join("、")}`);return}try{$.value=!0,i.value=null;const{error:h}=await N("/api/notifier/test").post(t).json();if(h.value)i.value=`❌ 通知连接测试失败

错误信息: ${h.value?.message||"未知错误"}
可能原因:
1. 配置信息错误
2. 通知服务无法访问
3. 网络连接问题`,g.error("通知连接测试失败");else{const j="测试成功",q=t.name;i.value=`✅ 通知连接测试成功！

通知名称: ${q}
通知类型: ${t.type}
测试响应: ${j.substring(0,200)}${j.length>200?"...":""}`,g.success("通知连接测试成功")}_.value=!0}catch(h){i.value=`❌ 测试过程中发生错误

错误信息: ${h.message||"未知错误"}
可能原因:
1. 网络连接中断
2. 服务器无响应
3. 请求超时`,g.error("测试过程中发生错误"),_.value=!0}finally{$.value=!1}},A=()=>{_.value=!1,i.value=null};return s({testNotifier:T,testing:$,testResult:i,testVisible:_}),(w,l)=>{const h=Ie,j=K,q=de,M=ue,L=Pe,C=qe,V=ee,ne=Se,pe=Z;return m(),x("div",rt,[n(pe,{model:e(t),"label-col":{span:5},"wrapper-col":{span:18}},{default:o(()=>[n(j,{label:"通知名称",name:"name",required:""},{default:o(()=>[n(h,{value:e(t).name,"onUpdate:value":l[0]||(l[0]=b=>e(t).name=b),placeholder:"输入通知名称"},null,8,["value"])]),_:1}),n(j,{label:"通知类型",name:"type",required:""},{default:o(()=>[n(M,{placeholder:"选择通知类型",value:e(t).type,"onUpdate:value":l[1]||(l[1]=b=>e(t).type=b),onChange:y,"allow-clear":""},{default:o(()=>[(m(!0),x(F,null,D(e(p),b=>(m(),U(q,{key:b.type,value:b.type},{default:o(()=>[k(S(b.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e(t).type&&e(O)?(m(!0),x(F,{key:0},D(e(O),(b,u)=>(m(),U(j,{key:u,label:b.name,name:u,required:b.required},{default:o(()=>[b.type==="password"?(m(),U(L,{key:0,value:e(t)[u],"onUpdate:value":E=>e(t)[u]=E,placeholder:b.placeholder||`输入${b.name}`},null,8,["value","onUpdate:value","placeholder"])):b.type==="number"?(m(),U(C,{key:1,value:e(t)[u],"onUpdate:value":E=>e(t)[u]=E,placeholder:b.placeholder||`输入${b.name}`,style:{width:"100%"}},null,8,["value","onUpdate:value","placeholder"])):(m(),U(h,{key:2,value:e(t)[u],"onUpdate:value":E=>e(t)[u]=E,placeholder:b.placeholder||`输入${b.name}`},null,8,["value","onUpdate:value","placeholder"]))]),_:2},1032,["label","name","required"]))),128)):z("",!0),n(j,{"wrapper-col":{offset:5,span:18}},{default:o(()=>[a("div",it,[a("div",ut,[n(V,{type:"primary",onClick:T,loading:e($),disabled:!e(t).name||!e(t).type},{default:o(()=>[n(e(G)),l[2]||(l[2]=k(" 测试连接 ",-1))]),_:1},8,["loading","disabled"]),!e(t).name||!e(t).type?(m(),U(ne,{key:0},{title:o(()=>[a("div",dt,[e(t).name?z("",!0):(m(),x("div",ct,"请填写通知名称")),e(t).type?z("",!0):(m(),x("div",pt,"请选择通知类型"))])]),default:o(()=>[n(e(Ne),{class:"text-gray-400"})]),_:1})):z("",!0)]),l[3]||(l[3]=a("span",{class:"text-gray-500 text-sm"}," 测试通过后再保存 ",-1))])]),_:1}),e(_)?(m(),U(j,{key:1,"wrapper-col":{offset:5,span:18}},{default:o(()=>[a("div",{class:Y(["mt-2 p-4 border rounded",e(i)?.includes("✅")?"border-green-200 bg-green-50":"border-red-200 bg-red-50"])},[a("div",ft,[a("h4",{class:Y(["font-medium",e(i)?.includes("✅")?"text-green-700":"text-red-700"])},S(e(i)?.includes("✅")?"✅ 测试成功":"❌ 测试失败"),3),n(V,{type:"text",size:"small",onClick:A},{default:o(()=>[...l[4]||(l[4]=[k(" 关闭 ",-1)])]),_:1})]),a("div",mt,[e(i)?.includes("✅")?(m(),x("div",vt,[l[5]||(l[5]=a("div",{class:"text-green-700 font-medium"},"配置验证通过！",-1)),a("div",_t,S(e(i).replace(`✅ 通知连接测试成功！

`,"")),1)])):(m(),x("div",gt,[l[6]||(l[6]=a("div",{class:"text-red-700 font-medium"},"配置验证失败",-1)),a("div",yt,S(e(i)?.replace("❌ ","")),1),l[7]||(l[7]=a("div",{class:"text-gray-600 text-xs mt-2"},[k(" 请检查以下配置： "),a("ul",{class:"list-disc pl-4 mt-1"},[a("li",null,"通知类型是否正确"),a("li",null,"配置信息是否完整"),a("li",null,"网络连接是否正常")])],-1))]))])],2)]),_:1})):z("",!0)]),_:1},8,["model"])])}}}),bt={class:"flex-col h-full space-y-4"},xt={key:0,class:"flex-col flex-1"},ht={class:"flex justify-between items-center mb-4"},wt={key:0,class:"flex-1 h-0 space-y-3 overflow-auto"},$t={class:"flex justify-between items-start"},kt={class:"flex gap-2.5"},Ot={class:"flex gap-2 ml-4"},Ct={key:1,class:"text-center py-8 border border-dashed border-gray-300 rounded"},jt=R({__name:"NotificationSettings",props:{config:{}},emits:["update:config"],setup(f,{emit:s}){const d=f,v=s,{data:c,execute:t}=N("/api/notifier",{initialData:[]}).json(),$=I(!1),i=I(!1),_=ie(()=>d.config),p=w=>{const l={..._.value,...w};v("update:config",l)},r=()=>{const w=I({id:"",type:"ntfy",name:"通知1",enable:!0});W.confirm({title:"新建通知",width:600,content:le(ke,{modelValue:w.value,"onUpdate:modelValue":l=>w.value=l}),async onOk(){try{$.value=!0;const l=w.value,{error:h}=await N("/api/notifier").post(l).json();h.value?g.error("添加失败"):(g.success("已添加"),await t())}catch{g.error("添加时发生错误")}finally{$.value=!1}}})},y=w=>{const l=c.value?.find(h=>h.id===w);l&&W.confirm({title:"确认删除",content:`确定要删除 "${l.name}" 吗？`,async onOk(){try{$.value=!0;const{error:h}=await N(`/api/notifier/${l.id}`).delete().json();h.value?g.error("删除失败"):(g.success("已删除"),await t())}catch{g.error("删除时发生错误")}finally{$.value=!1}}})},O=w=>{const l=c.value?.find(j=>j.id===w);if(!l)return;const h=I(l);W.confirm({title:"编辑通知配置",content:le(ke,{modelValue:h.value,"onUpdate:modelValue":j=>h.value=j}),async onOk(){try{$.value=!0;const{error:j}=await N(`/api/notifier/${h.value.id}`).post(h.value).json();j.value?g.error("更新失败"):(g.success("已更新"),await t())}catch{g.error("更新时发生错误")}finally{$.value=!1}}})},T=async w=>{const l=c.value?.find(h=>h.id===w);if(l)try{$.value=!0;const{error:h}=await N(`/api/notifier/${w}`).post({...l,enable:!l.enable}).json();h.value?g.error("请求失败"):(g.success(l.enable?"已禁用":"已启用"),await t())}catch{g.error("请求时发生错误")}finally{$.value=!1}},A=async w=>{const l=c.value?.find(h=>h.id===w);if(l)try{i.value=!0;const{error:h}=await N(`/api/notifier/${l.id}/test`).post().json();h.value?g.error("Notifier连接测试失败"):g.success("Notifier连接测试成功")}catch{g.error("测试Notifier连接时发生错误")}finally{i.value=!1}};return(w,l)=>{const h=_e,j=K,q=Z,M=ee,L=Re;return m(),x("div",bt,[l[10]||(l[10]=a("h3",{class:"text-lg font-medium"},"通知配置",-1)),n(q,{layout:"vertical",class:"max-w-2xl"},{default:o(()=>[n(j,{label:"启用通知"},{default:o(()=>[n(h,{checked:e(_).notifications.enabled,onChange:l[0]||(l[0]=C=>{const V={...e(_).notifications,enabled:!!C};p({notifications:V})})},null,8,["checked"]),l[1]||(l[1]=a("span",{class:"ml-2 text-gray-500"},"是否启用消息通知功能",-1))]),_:1})]),_:1}),e(_).notifications.enabled?(m(),x("div",xt,[a("div",ht,[l[3]||(l[3]=a("h4",{class:"text-md font-medium"},"已配置的通知",-1)),n(M,{type:"primary",onClick:r},{default:o(()=>[n(e(Q)),l[2]||(l[2]=k(" 添加通知 ",-1))]),_:1})]),e(c)&&e(c).length>0?(m(),x("div",wt,[(m(!0),x(F,null,D(e(c),C=>(m(),x("div",{key:C.id,class:"border border-gray-200 rounded p-4 bg-white hover:border-blue-300 transition-colors"},[a("div",$t,[a("div",kt,[C.enable?(m(),U(L,{key:0,color:"success"},{default:o(()=>[...l[4]||(l[4]=[k(" 已启用 ",-1)])]),_:1})):(m(),U(L,{key:1,color:"default"},{icon:o(()=>[n(e(ge))]),default:o(()=>[l[5]||(l[5]=k(" 未启用 ",-1))]),_:1})),n(h,{checked:C.enable,onChange:V=>T(C.id)},null,8,["checked","onChange"]),a("div",null,S(C.name),1),a("div",null,"提供商: "+S(C.type),1)]),a("div",Ot,[n(M,{type:"primary",size:"small",onClick:V=>O(C.id),disabled:e(i)},{default:o(()=>[...l[6]||(l[6]=[k(" 编辑 ",-1)])]),_:1},8,["onClick","disabled"]),n(M,{type:"default",size:"small",onClick:V=>A(C.id),loading:e(i)},{default:o(()=>[n(e(G)),l[7]||(l[7]=k(" 测试 ",-1))]),_:1},8,["onClick","loading"]),n(M,{type:"text",danger:"",size:"small",onClick:V=>y(C.id),disabled:e(i)},{default:o(()=>[n(e(te))]),_:1},8,["onClick","disabled"])])])]))),128))])):(m(),x("div",Ct,[l[9]||(l[9]=a("p",{class:"text-gray-500 mb-4"},"尚未配置任何通知",-1)),n(M,{type:"primary",onClick:r},{default:o(()=>[n(e(Q)),l[8]||(l[8]=k(" 添加第一个通知 ",-1))]),_:1})]))])):z("",!0)])}}}),At={class:"space-y-4"},It={key:0},Pt=R({__name:"EvaluatorSettings",props:{config:{}},emits:["update:config"],setup(f,{emit:s}){const d=f,v=s,c=ie(()=>d.config),{data:t}=N("/api/ai",{initialData:[]}).json(),$=i=>{const _={...c.value,...i};v("update:config",_)};return(i,_)=>{const p=_e,r=K,y=de,O=ue,T=Z;return m(),x("div",At,[_[4]||(_[4]=a("h3",{class:"text-lg font-medium"},"商品评估器配置",-1)),n(T,{layout:"vertical",class:"max-w-2xl"},{default:o(()=>[n(r,{label:"启用评估器"},{default:o(()=>[n(p,{checked:e(c).evaluator.enabled,onChange:_[0]||(_[0]=A=>{const w={...e(c).evaluator,enabled:!!A};$({evaluator:w})})},null,8,["checked"]),_[3]||(_[3]=a("span",{class:"ml-2 text-gray-500"},"是否启用AI商品分析评估",-1))]),_:1}),e(c).evaluator.enabled?(m(),x("div",It,[n(r,{label:"文本分析 AI"},{default:o(()=>[n(O,{value:e(c).evaluator.textAI||void 0,onChange:_[1]||(_[1]=A=>{const w={...e(c).evaluator,textAI:A||null};$({evaluator:w})}),class:"w-full",placeholder:"选择用于文本分析的 AI","allow-clear":""},{default:o(()=>[(m(!0),x(F,null,D(e(t),A=>(m(),U(y,{key:A.id,value:A.id},{default:o(()=>[k(S(A.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(r,{label:"图像分析 AI"},{default:o(()=>[n(O,{value:e(c).evaluator.imageAI||void 0,onChange:_[2]||(_[2]=A=>{const w={...e(c).evaluator,imageAI:A||null};$({evaluator:w})}),class:"w-full",placeholder:"选择用于图像分析的 AI","allow-clear":""},{default:o(()=>[(m(!0),x(F,null,D(e(t),A=>(m(),U(y,{key:A.id,value:A.id},{default:o(()=>[k(S(A.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})])):z("",!0)]),_:1})])}}});var se={exports:{}},Oe;function St(){return Oe||(Oe=1,(function(f,s){Function("return this")(),(function(d){f&&f.exports&&(s=f.exports=v),s.clone=v;function v(i){var _=typeof i;switch(_){case"object":if(i==null)return i;var p=void 0;return i instanceof Date?(p=new Date,p.setTime(i.getTime()),p):i instanceof RegExp?(p=$(i),p):(p=JSON.parse(JSON.stringify(i)),t(i,p),p);default:return i}}function c(i,_,p){var r=i[p],y=typeof r;switch(y){case"object":if(r instanceof Date){var O=new Date;O.setTime(r.getTime()),_[p]=O}else r instanceof RegExp?_[p]=$(r):r==null?_[p]=r:t(r,_[p]);break;case"number":isNaN(r)?_[p]=NaN:r==1/0&&(_[p]=1/0);break}}function t(i,_){if(i instanceof Array)for(var p=0;p<i.length;p++)c(i,_,p);else{var r=Object.getOwnPropertyNames(i);r.forEach(function(y){c(i,_,y)})}}function $(i){var _=String(i),p=_.lastIndexOf("/");return new RegExp(_.slice(1,p),_.slice(p+1))}})()})(se,se.exports)),se.exports}var Nt=St();const Ce=He(Nt),Tt={class:"space-y-4"},zt={class:"flex flex-col gap-2"},Et={key:0,class:"mb-2"},Vt={class:"font-mono text-sm"},Ut={class:"text-blue-600"},Bt={class:"text-green-600"},Ht={key:1,class:"flex flex-col gap-2"},Mt={class:"flex gap-2"},Lt={key:2,class:"flex gap-2"},Ft={class:"flex flex-col gap-2"},Dt={key:0,class:"flex flex-col gap-2"},qt={class:"flex gap-2"},Rt={key:1},Jt={class:"mb-2"},Wt={class:"bg-gray-50 p-3 rounded text-sm overflow-auto max-h-40"},Gt={class:"flex gap-2"},Yt={class:"flex items-center pt-4 border-t border-gray-200"},Qt={class:"flex items-center gap-2"},Xt={class:"text-xs"},Zt={key:0},Kt={key:1},en={key:2},tn={key:3},nn={class:"flex justify-between items-start mb-2"},an={class:"text-sm whitespace-pre-wrap font-mono bg-white/50 p-3 rounded"},sn={key:0,class:"space-y-2"},on={class:"text-gray-700"},ln={key:1,class:"space-y-2"},rn={class:"text-gray-700"},un=R({__name:"AIForm",props:{modelValue:{}},emits:["update:modelValue"],setup(f,{expose:s,emit:d}){const v=f,c=d,t=Ae({...v.modelValue}),$=I(!1),i=I(!1),_=I(!1),p=I(""),r=I(""),{data:y}=N("/api/ai/templates").json();oe(t,()=>{c("update:modelValue",{...t})},{deep:!0}),oe(()=>t.headers,b=>{p.value=J(b||{})},{immediate:!0}),oe(()=>t.body,b=>{r.value=J(b||{})},{immediate:!0});const O=b=>{if(!b)return;const u=y.value?.find(E=>E.id===b);if(!u)return g.error("未找到模板");t.endpoint=u.endpoint,t.model=u.model,t.headers=Ce(u.headers),t.body=Ce(u.body)},T=()=>{t.headers||(t.headers={});const b=prompt("请输入请求头的键名：");if(!b)return;const u=prompt("请输入请求头的值：");u!==null&&(t.headers[b]=u,p.value=J(t.headers))},A=b=>{t.headers&&t.headers[b]&&(delete t.headers[b],p.value=J(t.headers))},w=()=>{i.value=!0},l=()=>{try{t.headers=JSON.parse(p.value),i.value=!1,g.success("请求头保存成功")}catch{g.error("JSON格式错误，请检查输入")}},h=()=>{p.value=J(t.headers||{}),i.value=!1},j=()=>{_.value=!0},q=()=>{try{t.body=JSON.parse(r.value),_.value=!1,g.success("请求体保存成功")}catch{g.error("JSON格式错误，请检查输入")}},M=()=>{r.value=J(t.body||{}),_.value=!1},L=I(!1),C=I(null),V=I(!1),ne=async()=>{const b=[];if(t.name||b.push("Agent名称"),t.endpoint||b.push("API端点"),t.model||b.push("模型名称"),t.api_key||b.push("API密钥"),b.length>0){g.error(`请填写以下必填字段：${b.join("、")}`);return}try{L.value=!0,C.value=null;const u={id:"test-"+Date.now(),name:t.name,endpoint:t.endpoint,api_key:t.api_key,model:t.model,proxy:t.proxy||"",headers:t.headers,body:t.body},{error:E,data:B}=await N("/api/ai/test").post(u).json();if(!E.value&&B.value){const ae=B.value.response||"测试成功",fe=u.name;C.value=`✅ 连接测试成功！

名称: ${fe}
模型: ${u.model}
API端点: ${u.endpoint}
测试响应: ${ae.substring(0,200)}${ae.length>200?"...":""}`,g.success("连接测试成功")}else C.value=`❌ 连接测试失败

错误信息: ${E.value?.message||"未知错误"}
可能原因:
1. API密钥无效
2. 模型名称错误
3. API端点无法访问
4. 网络连接问题
5. 请求头/请求体配置错误`,g.error("连接测试失败");V.value=!0}catch(u){C.value=`❌ 测试过程中发生错误

错误信息: ${u.message||"未知错误"}
可能原因:
1. 网络连接中断
2. 服务器无响应
3. 请求超时`,g.error("测试过程中发生错误"),V.value=!0}finally{L.value=!1}},pe=()=>{V.value=!1,C.value=null};return s({testConfig:ne,testing:L,testResult:C,testVisible:V}),(b,u)=>{const E=Ie,B=K,ae=de,fe=ue,Te=Pe,H=ee,ze=We,ye=Me,Ee=Se,Ve=Z;return m(),x("div",Tt,[n(Ve,{model:e(t),"label-col":{span:5},"wrapper-col":{span:18}},{default:o(()=>[n(B,{label:"名称",name:"name",required:""},{default:o(()=>[n(E,{value:e(t).name,"onUpdate:value":u[0]||(u[0]=P=>e(t).name=P),placeholder:"输入名称"},null,8,["value"])]),_:1}),n(B,{label:"模板选择"},{default:o(()=>[n(fe,{placeholder:"选择预设模板",onChange:O,"allow-clear":""},{default:o(()=>[(m(!0),x(F,null,D(e(y),P=>(m(),U(ae,{key:P.id,value:P.id},{default:o(()=>[k(S(P.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1}),n(B,{label:"API端点",name:"endpoint",required:""},{default:o(()=>[n(E,{value:e(t).endpoint,"onUpdate:value":u[1]||(u[1]=P=>e(t).endpoint=P),placeholder:"https://api.openai.com/v1/chat/completions"},null,8,["value"])]),_:1}),n(B,{label:"API密钥"},{default:o(()=>[n(Te,{value:e(t).api_key,"onUpdate:value":u[2]||(u[2]=P=>e(t).api_key=P),placeholder:"输入API密钥"},null,8,["value"])]),_:1}),n(B,{label:"模型名称",name:"model",required:""},{default:o(()=>[n(E,{value:e(t).model,"onUpdate:value":u[3]||(u[3]=P=>e(t).model=P),placeholder:"gpt-3.5-turbo"},null,8,["value"])]),_:1}),n(ze,{align:"right"},{default:o(()=>[n(H,{type:"link",onClick:u[4]||(u[4]=P=>$.value=!e($)),class:"p-0 h-auto"},{default:o(()=>[k(S(e($)?"收起":"展开")+"高级配置 ",1),n(e(De),{class:Y({"rotate-180":e($)})},null,8,["class"])]),_:1})]),_:1}),e($)?(m(),x(F,{key:0},[n(B,{label:"代理地址"},{default:o(()=>[n(E,{value:e(t).proxy,"onUpdate:value":u[5]||(u[5]=P=>e(t).proxy=P),placeholder:"代理地址 http://proxy:port"},null,8,["value"])]),_:1}),n(B,{label:"请求头配置"},{default:o(()=>[a("div",zt,[e(t).headers&&Object.keys(e(t).headers).length>0?(m(),x("div",Et,[(m(!0),x(F,null,D(e(t).headers,(P,me)=>(m(),x("div",{key:me,class:"flex items-center justify-between py-1 px-2 bg-gray-50 rounded mb-1"},[a("span",Vt,[a("span",Ut,S(me),1),u[8]||(u[8]=k(": ",-1)),a("span",Bt,S(P),1)]),n(H,{type:"text",danger:"",size:"small",onClick:Sn=>A(me)},{default:o(()=>[n(e(te))]),_:1},8,["onClick"])]))),128))])):z("",!0),e(i)?(m(),x("div",Ht,[n(ye,{value:e(p),"onUpdate:value":u[6]||(u[6]=P=>ve(p)?p.value=P:null),rows:6,placeholder:'输入JSON格式的请求头，例如：{"Authorization": "Bearer {key}", "Content-Type": "application/json"}'},null,8,["value"]),a("div",Mt,[n(H,{type:"primary",onClick:l},{default:o(()=>[...u[9]||(u[9]=[k("保存",-1)])]),_:1}),n(H,{onClick:h},{default:o(()=>[...u[10]||(u[10]=[k("取消",-1)])]),_:1})])])):(m(),x("div",Lt,[n(H,{onClick:T,type:"dashed"},{default:o(()=>[n(e(Q)),u[11]||(u[11]=k(" 添加请求头 ",-1))]),_:1}),n(H,{onClick:w},{default:o(()=>[n(e(re)),u[12]||(u[12]=k(" 编辑JSON ",-1))]),_:1})]))])]),_:1}),n(B,{label:"请求体配置"},{default:o(()=>[a("div",Ft,[e(_)?(m(),x("div",Dt,[n(ye,{value:e(r),"onUpdate:value":u[7]||(u[7]=P=>ve(r)?r.value=P:null),rows:8,placeholder:'输入JSON格式的请求体模板，例如：{"model": "{model}", "messages": {messages}, "temperature": 0.2}',有好感:""},null,8,["value"]),a("div",qt,[n(H,{type:"primary",onClick:q},{default:o(()=>[...u[13]||(u[13]=[k("保存",-1)])]),_:1}),n(H,{onClick:M},{default:o(()=>[...u[14]||(u[14]=[k("取消",-1)])]),_:1})])])):(m(),x("div",Rt,[a("div",Jt,[a("pre",Wt,S(e(r)),1)]),a("div",Gt,[n(H,{onClick:j},{default:o(()=>[n(e(re)),u[15]||(u[15]=k(" 编辑请求体 ",-1))]),_:1})])]))])]),_:1})],64)):z("",!0),n(B,{"wrapper-col":{offset:5,span:18}},{default:o(()=>[a("div",Yt,[a("div",Qt,[n(H,{type:"primary",onClick:ne,loading:e(L),disabled:!e(t).name||!e(t).endpoint||!e(t).model||!e(t).api_key},{default:o(()=>[n(e(G)),u[16]||(u[16]=k(" 测试连接 ",-1))]),_:1},8,["loading","disabled"]),!e(t).name||!e(t).endpoint||!e(t).model||!e(t).api_key?(m(),U(Ee,{key:0},{title:o(()=>[a("div",Xt,[e(t).name?z("",!0):(m(),x("div",Zt,"请填写Agent名称")),e(t).endpoint?z("",!0):(m(),x("div",Kt,"请填写API端点")),e(t).model?z("",!0):(m(),x("div",en,"请填写模型名称")),e(t).api_key?z("",!0):(m(),x("div",tn,"请填写API密钥"))])]),default:o(()=>[n(e(Ne),{class:"text-gray-400"})]),_:1})):z("",!0)]),u[17]||(u[17]=a("span",{class:"text-gray-500 text-sm"}," 测试通过后再保存 ",-1))])]),_:1}),e(V)?(m(),U(B,{key:1,"wrapper-col":{offset:5,span:18}},{default:o(()=>[a("div",{class:Y(["mt-2 p-4 border rounded",e(C)?.includes("✅")?"border-green-200 bg-green-50":"border-red-200 bg-red-50"])},[a("div",nn,[a("h4",{class:Y(["font-medium",e(C)?.includes("✅")?"text-green-700":"text-red-700"])},S(e(C)?.includes("✅")?"✅ 测试成功":"❌ 测试失败"),3),n(H,{type:"text",size:"small",onClick:pe},{default:o(()=>[...u[18]||(u[18]=[k(" 关闭 ",-1)])]),_:1})]),a("div",an,[e(C)?.includes("✅")?(m(),x("div",sn,[u[19]||(u[19]=a("div",{class:"text-green-700 font-medium"},"配置验证通过！",-1)),a("div",on,S(e(C).replace(`✅ Agent连接测试成功！

`,"")),1)])):(m(),x("div",ln,[u[20]||(u[20]=a("div",{class:"text-red-700 font-medium"},"配置验证失败",-1)),a("div",rn,S(e(C)?.replace("❌ ","")),1),u[21]||(u[21]=a("div",{class:"text-gray-600 text-xs mt-2"},[k(" 请检查以下配置： "),a("ul",{class:"list-disc pl-4 mt-1"},[a("li",null,"API端点是否正确"),a("li",null,"API密钥是否有效"),a("li",null,"模型名称是否正确"),a("li",null,"网络连接是否正常")])],-1))]))])],2)]),_:1})):z("",!0)]),_:1},8,["model"])])}}}),je=Je(un,[["__scopeId","data-v-bd73a66c"]]),dn={class:"flex-col h-full space-y-4"},cn={class:"flex-col flex-1"},pn={class:"flex justify-between items-center mb-4"},fn={key:0,class:"space-y-3 h-0 flex-1 overflow-auto"},mn={class:"flex justify-between items-start"},vn={class:"flex-1"},_n={class:"flex items-center gap-2 mb-2"},gn={class:"font-medium text-gray-800"},yn={class:"text-xs px-2 py-1 bg-gray-100 rounded text-gray-600"},bn={class:"text-sm text-gray-600 space-y-1"},xn={class:"flex items-center gap-2"},hn={class:"text-xs bg-gray-50 px-2 py-1 rounded truncate max-w-xs"},wn={class:"flex items-center gap-2"},$n={class:"text-xs"},kn={class:"flex gap-2 ml-4"},On={key:1,class:"text-center py-8 border border-dashed border-gray-300 rounded"},Cn=R({__name:"AISettings",setup(f){const{data:s,execute:d}=N("/api/ai",{initialData:[]}).json(),v=I(!1),c=I(!1),t=()=>{const p=I({id:"",name:"AI",endpoint:"",api_key:"",model:"",headers:{Authorization:"Bearer {key}","Content-Type":"application/json"},body:{model:"{model}",messages:"{messages}"}});W.confirm({title:"创建 AI 配置",width:600,content:le(je,{modelValue:p.value,"onUpdate:modelValue":r=>p.value=r}),async onOk(){try{v.value=!0;const{error:r}=await N("/api/ai").post(p.value).json();r.value?g.error("添加失败"):(g.success("已添加"),await d())}catch{g.error("添加时发生错误")}finally{v.value=!1}}})},$=p=>{const r=s.value?.find(y=>y.id===p);r&&W.confirm({title:"确认删除",content:`确定要删除 "${r.name}" 吗？`,async onOk(){try{v.value=!0;const{error:y}=await N(`/api/ai/${r.id}`).delete().json();y.value?g.error("删除失败"):(g.success("已删除"),await d())}catch{g.error("删除时发生错误")}finally{v.value=!1}}})},i=p=>{const r=s.value?.find(O=>O.id===p);if(!r)return;const y=I(r);W.confirm({title:"编辑 AI 配置",width:600,content:le(je,{modelValue:y.value,"onUpdate:modelValue":O=>y.value=O}),async onOk(){try{v.value=!0;const{error:O}=await N(`/api/ai/${y.value.id}`).post(y.value).json();O.value?g.error("更新失败"):(g.success("已更新"),await d())}catch{g.error("更新时发生错误")}finally{v.value=!1}}})},_=async p=>{const r=s.value?.find(y=>y.id===p);if(r)try{c.value=!0;const{error:y}=await N(`/api/ai/${r.id}/test`).post().json();y.value?g.error("连接测试失败"):g.success("连接测试成功")}catch{g.error("测试连接时发生错误")}finally{c.value=!1}};return(p,r)=>{const y=ee;return m(),x("div",dn,[r[8]||(r[8]=a("h3",{class:"text-lg font-medium"},"AI 配置",-1)),a("div",cn,[a("div",pn,[r[1]||(r[1]=a("h4",{class:"text-md font-medium"},"已配置的 AI",-1)),n(y,{type:"primary",onClick:t,loading:e(v)},{default:o(()=>[n(e(Q)),r[0]||(r[0]=k(" 添加AI ",-1))]),_:1},8,["loading"])]),e(s)&&e(s).length>0?(m(),x("div",fn,[(m(!0),x(F,null,D(e(s),O=>(m(),x("div",{key:O.id,class:"border border-gray-200 rounded p-4 bg-white hover:border-blue-300 transition-colors"},[a("div",mn,[a("div",vn,[a("div",_n,[a("h5",gn,S(O.name),1),a("span",yn,S(O.model),1)]),a("div",bn,[a("div",xn,[r[2]||(r[2]=a("span",{class:"font-medium"},"端点:",-1)),a("code",hn,S(O.endpoint),1)]),a("div",wn,[r[3]||(r[3]=a("span",{class:"font-medium"},"API密钥:",-1)),a("span",$n,S(O.api_key?"••••••••":"未设置"),1)])])]),a("div",kn,[n(y,{type:"primary",size:"small",onClick:T=>i(O.id),disabled:e(c)},{default:o(()=>[...r[4]||(r[4]=[k(" 编辑 ",-1)])]),_:1},8,["onClick","disabled"]),n(y,{type:"default",size:"small",onClick:T=>_(O.id),loading:e(c)},{default:o(()=>[n(e(G)),r[5]||(r[5]=k(" 测试 ",-1))]),_:1},8,["onClick","loading"]),n(y,{type:"text",danger:"",size:"small",onClick:T=>$(O.id),disabled:e(c)},{default:o(()=>[n(e(te))]),_:1},8,["onClick","disabled"])])])]))),128))])):(m(),x("div",On,[r[7]||(r[7]=a("p",{class:"text-gray-500 mb-4"},"尚未配置任何 AI",-1)),n(y,{type:"primary",onClick:t},{default:o(()=>[n(e(Q)),r[6]||(r[6]=k(" 添加第一个 AI ",-1))]),_:1})]))])])}}}),jn={class:"flex-col p-4 h-full"},An={class:"flex justify-between mb-6 items-center"},In={class:"flex items-center space-x-2.5"},Pn={key:0,class:"space-x-2 text-orange"},Mn=R({__name:"system",setup(f){const s=I("browser"),d=I(!1),v=I(!1),{data:c,execute:t}=N("api/system",{initialData:{browser:{headless:!0,channel:"chrome"},notifications:{enabled:!1,providers:[]},evaluator:{enabled:!0,textAI:null,imageAI:null}}}).json(),$=_=>{d.value=!0,c.value=_},i=async()=>{v.value=!0;const{error:_}=await N("api/system").post(c.value).json();v.value=!1,_.value?g.error("保存失败"):(g.success("保存成功"),d.value=!1,await t())};return(_,p)=>{const r=ee,y=Fe,O=Le;return m(),x("div",jn,[a("div",An,[p[3]||(p[3]=a("h2",{class:"text-xl font-semibold"},"系统设置",-1)),a("div",In,[e(d)?(m(),x("div",Pn,[n(e(ce)),p[1]||(p[1]=a("span",null,"配置未保存",-1))])):z("",!0),n(r,{type:"primary",onClick:i,loading:e(v)},{default:o(()=>[...p[2]||(p[2]=[k(" 保存配置 ",-1)])]),_:1},8,["loading"])])]),n(O,{activeKey:e(s),"onUpdate:activeKey":p[0]||(p[0]=T=>ve(s)?s.value=T:null),class:"h-0 flex-1 [&>.ant-tabs-content]:h-full"},{default:o(()=>[n(y,{key:"browser",tab:"浏览器设置"},{default:o(()=>[n(lt,{config:e(c),"onUpdate:config":$},null,8,["config"])]),_:1}),n(y,{key:"notifications",tab:"通知设置"},{default:o(()=>[n(jt,{config:e(c),"onUpdate:config":$},null,8,["config"])]),_:1}),n(y,{key:"evaluator",tab:"商品评估器设置"},{default:o(()=>[n(Pt,{config:e(c),"onUpdate:config":$},null,8,["config"])]),_:1}),n(y,{key:"ai",tab:"AI设置"},{default:o(()=>[n(Cn)]),_:1})]),_:1},8,["activeKey"])])}}});export{Mn as default};
